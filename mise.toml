[tools]
go = "latest"

[tasks]
setup = "mkdir -p ~/.config/mockingbird && cp examples/* ~/.config/mockingbird/"
build = "go build -o mockingbird ./cmd/server"

[tasks.webui-build]
run='''
#!/bin/bash
set -euo pipefail
cd webui
npm run build
'''

[tasks.start]
depends = ["build","webui-build"]
run = "./mockingbird"

[tasks.docker-build]
depends = ["build"]
run = '''
VERSION=$(git describe --tags --abbrev=0 2>/dev/null || echo "dev")
echo "Building Docker image with tag: $VERSION"
docker build -t charleslobo77/mockingbird:$VERSION -t charleslobo77/mockingbird:latest .
'''

[tasks.docker-push]
depends = ["docker-build"]
run = '''
VERSION=$(git describe --tags --abbrev=0 2>/dev/null || echo "dev")
echo "Pushing Docker image with tag: $VERSION"
docker push charleslobo77/mockingbird:$VERSION
docker push charleslobo77/mockingbird:latest
'''
